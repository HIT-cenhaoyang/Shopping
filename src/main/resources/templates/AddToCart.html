<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  
    <title>Add Products to Cart</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <h1>Add Products to Cart</h1>
    
    <div class="products-container" id="products-container">
        <!-- Products will be loaded here dynamically -->
    </div>

    <button onclick="goToCart()">View Cart</button>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            loadProducts();
        });

        async function loadProducts() {
            try {
                let response = await fetch("/api/products");
                if (response.ok) {
                    let products = await response.json();
                    products.forEach(product => addProductToPage(product));
                } else {
                    console.error("Failed to load products.");
                }
            } catch (error) {
                console.error("Error fetching products: ", error);
            }
        }

        function addProductToPage(product) {
            const productsContainer = document.getElementById('products-container');

            const productItem = document.createElement('div');
            productItem.classList.add('product-item');
            const coverImage = product.images && product.images.length > 0 ? product.images[0].fileName : 'default.jpg';

            productItem.innerHTML = `
                <img src="/images/${coverImage}" alt="${product.name}">
                <div class="item-info">
                    <h3>${product.name}</h3>
                    <p>${product.description}</p>
                    <p>Price per unit: $${product.price.toFixed(2)}</p>
                </div>
                <button onclick="addToCart(${product.productId}, 1)">Add to Cart</button>
            `;
            productsContainer.appendChild(productItem);
        }

        function addToCart(productId, quantity) {
            fetch(`/api/cart/add`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ productId: productId, quantity: quantity })
            }).then(response => {
                if (response.ok) {
                    alert('Product added to cart!');
                } else {
                    alert('Failed to add product to cart.');
                }
            }).catch(error => {
                alert('Error: ' + error.message);
            });
        }

        function goToCart() {
            window.location.href = "/cart";
        }
    </script>
</body>
</html>
