<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
	<meta charset="UTF-8">
	<title>Product Page</title>
	<link rel="stylesheet" type="text/css" th:href="@{/styles/homepagestyle.css}">
	<style>
		.carousel-container {
			position: relative;
			width: 100%; /* Full width */
			max-width: 1200px; /* Maximum width */
			margin-bottom: 40px; /* Centered with margin */
			margin-top: 0;
			overflow: hidden; /* Hide overflow */
			border-radius: 3px;
			box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Shadow effect */
			height: 600px; /* Increase height */
		}

		.carousel-slide {
			display: flex;
			transition: transform 0.5s ease-in-out;
		}

		.slide {
			min-width: 100%;
			box-sizing: border-box;
		}

		.carousel-dots {
			position: absolute;
			bottom: 20px; /* Position the dots slightly above the bottom of the container */
			left: 50%;
			transform: translateX(-50%);
			display: flex;
			justify-content: center;
		}

		.carousel-dots .dot {
			display: inline-block;
			width: 12px;
			height: 12px;
			margin: 0 5px;
			background-color: rgba(255, 255, 255, 0.7); /* Transparent white background */
			border-radius: 50%;
			cursor: pointer;
			transition: background-color 0.3s ease;
		}

		.carousel-dots .dot.active {
			background-color: #ffffff; /* Active dot is white */
		}

		.carousel-dots .dot:hover {
			background-color: #717171; /* Hover state for dots */
		}


	</style>
</head>

<body>
	<div th:replace="fragments :: header"></div>

	<section>
		<!-- 提示信息 -->
		<div th:if="${message}" class="message">
			<p th:text="${message}"></p>
		</div>

		<div th:if="${currentPage == 1} and ${#strings.equals(pageName, 'mainPage')}" class="carousel-container">
			<div class="carousel-slide">
				<!-- Thymeleaf loop to display hot product images -->
				<div th:each="imageUrl, indexStat : ${hotProducts}" class="slide">
					<img th:src="@{|${imageUrl}|}" alt="Hot Product">
				</div>
			</div>
			<!-- 小圆点显示，悬浮在图片上 -->
			<div class="carousel-dots">
		<span th:each="hotProduct, indexStat : ${hotProducts}" class="dot"
			  th:classappend="${indexStat.index == 0} ? 'active' : ''"></span>
			</div>
		</div>



		<!-- 产品展示 -->
		<div class="products-container">
			<div th:each="product : ${products}" class="product">
				<a th:href="@{/product/{id}(id=${product.productId})}">
					<img th:src="@{|${product.coverImagePath}|}" alt="product image">
				</a>
				<h2 th:text="${product.name}" style="color: #333;" class = "product-name">product name</h2>
				<p class="price" th:text="'$' + ${#numbers.formatDecimal(product.price, 1, 'COMMA', 2, 'POINT')}">price</p>
			</div>
		</div>

		<div class="pagination">
			<a th:if="${currentPage > 1} and ${categoryId != null}"
				th:href="@{products(page=${currentPage - 1}, size=10, category=${categoryId})}">&laquo; Previous</a>
			<a th:if="${currentPage > 1} and ${categoryId == null} and ${keyword == null}"
				th:href="@{/products(page=${currentPage - 1}, size=10)}">&laquo; Previous</a>
			<a th:if="${currentPage > 1} and ${categoryId == null} and ${keyword != null}"
				th:href="@{/products/search(keyword=${keyword}, page=${currentPage - 1}, size=10)}">&laquo; Previous</a>

			<span th:if="${totalPages != null}" th:each="i : ${#numbers.sequence(1, totalPages)}"
				th:classappend="${i == currentPage} ? 'active'">
				<a th:if="${categoryId != null}" th:href="@{/products(page=${i}, size=10, category=${categoryId})}"
					th:text="${i}"></a>
				<a th:if="${categoryId == null} and ${keyword == null}" th:href="@{products(page=${i}, size=10)}"
					th:text="${i}"></a>
				<a th:if="${categoryId == null} and ${keyword != null}"
					th:href="@{products/search(keyword=${keyword}, page=${i}, size=10)}" th:text="${i}"></a>
			</span>

			<span th:if="${totalPages == null}" th:each="i : ${#numbers.sequence(1, 1)}"
				th:classappend="${i == currentPage} ? 'active'">
				<a th:if="${categoryId != null}" th:href="@{/products(page=${i}, size=10, category=${categoryId})}"
					th:text="${i}"></a>
				<a th:if="${categoryId == null} and ${keyword == null}" th:href="@{/products(page=${i}, size=10)}"
					th:text="${i}"></a>
				<a th:if="${categoryId == null} and ${keyword != null}"
					th:href="@{/products/search(keyword=${keyword}, page=${i}, size=10)}" th:text="${i}"></a>
			</span>

			<a th:if="${currentPage < totalPages} and ${categoryId != null}"
				th:href="@{/products(page=${currentPage + 1}, size=10, category=${categoryId})}">Next &raquo;</a>
			<a th:if="${currentPage < totalPages} and ${categoryId == null} and ${keyword == null}"
				th:href="@{/products(page=${currentPage + 1}, size=10)}">Next &raquo;</a>
			<a th:if="${currentPage < totalPages} and ${categoryId == null} and ${keyword != null}"
				th:href="@{/products/search(keyword=${keyword}, page=${currentPage + 1}, size=10)}">Next &raquo;</a>
		</div>

	</section>

	<div th:replace="foot :: footer"></div>

	<script>
		document.addEventListener('DOMContentLoaded', function () {
			let currentIndex = 0;
			const slides = document.querySelectorAll('.carousel-slide .slide');
			const totalSlides = slides.length;
			const dots = document.querySelectorAll('.carousel-dots .dot');
			const carouselSlide = document.querySelector('.carousel-slide');

			function updateCarousel() {
				const slideWidth = carouselSlide.clientWidth;
				carouselSlide.style.transition = 'transform 0.5s ease-in-out'; // 正常过渡
				carouselSlide.style.transform = `translateX(-${currentIndex * slideWidth}px)`;

				// 更新小圆点的状态
				dots.forEach(dot => dot.classList.remove('active'));
				dots[currentIndex].classList.add('active');
			}

			// 无缝过渡到第一张
			function seamlessTransition() {
				const slideWidth = carouselSlide.clientWidth;
				carouselSlide.style.transition = 'none'; // 立即跳转，不要过渡效果
				carouselSlide.style.transform = `translateX(0)`; // 回到第一张
				currentIndex = 0; // 重置索引
			}

			// 下一张图片
			function showNextSlide() {
				currentIndex++;
				if (currentIndex >= totalSlides) {
					// 如果超出最后一张，延迟0.5秒后无缝跳转到第一张
					setTimeout(seamlessTransition, 500);
				} else {
					updateCarousel();
				}
			}

			// 点击切换到指定图片
			dots.forEach((dot, index) => {
				dot.addEventListener('click', () => {
					currentIndex = index;
					updateCarousel();
				});
			});

			// 每5秒自动切换图片
			setInterval(showNextSlide, 5000);
		});

	</script>
</body>


</html>